<%- include('../layout', {body: `
<div class="container">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="fas fa-user me-2"></i>My Profile</h4>
                </div>
                <div class="card-body">
                    <div id="profile-content">
                        <div class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading profile...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    if (!authManager.requireAuth()) return;
    
    loadProfile();
});

async function loadProfile() {
    try {
        const response = await apiGet('/api/auth/me');
        const data = await response.json();
        
        displayProfile(data.user, data.profile);
    } catch (error) {
        console.error('Failed to load profile:', error);
        document.getElementById('profile-content').innerHTML = 
            '<div class="alert alert-danger">Failed to load profile. Please try again.</div>';
    }
}

function displayProfile(user, profile) {
    const content = document.getElementById('profile-content');
    
    content.innerHTML = \`
        <div class="row">
            <div class="col-md-4 text-center mb-4">
                <img src="\${profile?.profile_picture || '/images/default-avatar.png'}" 
                     alt="Profile Picture" 
                     class="profile-image">
                <h5 class="mt-3">\${user.email}</h5>
                <p class="text-muted">\${user.user_type.charAt(0).toUpperCase() + user.user_type.slice(1)}</p>
            </div>
            <div class="col-md-8">
                <h5>Profile Information</h5>
                <div class="row mb-3">
                    <div class="col-sm-4"><strong>Name:</strong></div>
                    <div class="col-sm-8">\${profile?.name || 'Not set'}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4"><strong>Email:</strong></div>
                    <div class="col-sm-8">\${user.email}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4"><strong>Phone:</strong></div>
                    <div class="col-sm-8">\${profile?.phone || 'Not set'}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4"><strong>Location:</strong></div>
                    <div class="col-sm-8">\${profile?.location || 'Not set'}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4"><strong>Bio:</strong></div>
                    <div class="col-sm-8">\${profile?.bio || 'Not set'}</div>
                </div>
                
                <div class="mt-4">
                    <a href="/profile/create" class="btn btn-primary">
                        <i class="fas fa-edit me-2"></i>Edit Profile
                    </a>
                </div>
            </div>
        </div>
    \`;
}
</script>
`}) %>